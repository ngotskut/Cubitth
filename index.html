<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Flappy Lamumu ‚Äî Orbit Day/Night (15s per phase)</title>
<style>
  *,*::before,*::after{box-sizing:border-box}
  html,body{height:100%;margin:0}
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;overflow:hidden;background:#000}
  #wrap{position:fixed;inset:0}
  #game{position:absolute;inset:0;display:block;background:#000}
  #score{
    position:absolute;top:8px;left:50%;transform:translateX(-50%);
    font-weight:800;font-size:18px;pointer-events:none
  }
  #overlay{position:absolute;inset:0;background:rgba(0,0,0,.35);
    display:flex;align-items:center;justify-content:center;z-index:8}
  #startPanel{
    width:min(600px,92vw);background:rgba(255,255,255,.96);border-radius:18px;
    box-shadow:0 20px 60px rgba(0,0,0,.35);padding:22px 20px;text-align:center
  }
  .btn{appearance:none;border:0;border-radius:999px;padding:10px 16px;font-weight:700;background:#2563eb;color:#fff;cursor:pointer}
</style>
</head>
<body>
<div id="wrap">
  <canvas id="game"></canvas>
  <div id="score">Score: 0</div>

  <div id="overlay">
    <div id="startPanel">
      <h2>Flappy Lamumu üêÆ</h2>
      <p style="margin:6px 0 12px;color:#4b5563">Tap / Click untuk flap ¬∑ Tekan <b>C</b> ganti karakter</p>
      <button id="btnStart" class="btn">Start</button>
    </div>
  </div>
</div>

<script>
(() => {
/* ========= Canvas setup ========= */
const canvas=document.getElementById('game');
const ctx=canvas.getContext('2d');
const scoreEl=document.getElementById('score');
const overlay=document.getElementById('overlay');
const btnStart=document.getElementById('btnStart');

let W=0,H=0,DPR=Math.max(1,Math.min(2,window.devicePixelRatio||1));
function resize(){
  W=innerWidth|0; H=innerHeight|0;
  canvas.width=(W*DPR)|0; canvas.height=(H*DPR)|0;
  canvas.style.width=W+'px'; canvas.style.height=H+'px';
  ctx.setTransform(DPR,0,0,DPR,0,0);
}
addEventListener('resize',resize,{passive:true}); resize();

/* ========= Game state (sederhana) ========= */
const state={ running:false, score:0, time:0, gravity:900, flapVel:-400,
  speedBase:190, speedMax:420, speed:190, pipesPassed:0, speedPerPipe:2.2 };
const player={ x:0, y:0, vy:0, r:22 };
const pipes=[]; const bonuses=[];
const PIPE={ width:Math.max(80,(W*0.08)|0), gapBase:Math.max(160,(H*0.28)|0), spawnMin:Math.max(240,(W*0.36)|0), spawnMax:Math.max(280,(W*0.42)|0) };
const BONUS={ sizeBase:Math.max(34,(Math.min(W,H)*0.10)|0), rotateSpeed:2.0, chance:0.65, yOffset:20 };

function rand(a,b){ return a+Math.random()*(b-a); }
function clamp(v,a,b){ return Math.max(a,Math.min(b,v)); }
function dist(x1,y1,x2,y2){ const dx=x1-x2, dy=y1-y2; return Math.hypot(dx,dy); }
function circleRect(cx,cy,cr, rx,ry,rw,rh){ const tx=Math.max(rx,Math.min(cx,rx+rw)), ty=Math.max(ry,Math.min(cy,ry+rh)); const dx=cx-tx, dy=cy-ty; return dx*dx+dy*dy<=cr*cr; }

/* ========= Input ========= */
function flap(){ if(state.running){ player.vy = state.flapVel; } }
canvas.addEventListener('mousedown',flap);
canvas.addEventListener('touchstart',e=>{e.preventDefault();flap();},{passive:false});
addEventListener('keydown',e=>{ if(e.code==='Space'){e.preventDefault();flap();} });

btnStart.addEventListener('click',()=>{
  state.running=true; state.score=0; state.time=0; state.pipesPassed=0; state.speed=state.speedBase;
  player.x=Math.max(80,(W*0.18)|0); player.y=(H*0.45)|0; player.vy=0;
  pipes.length=0; bonuses.length=0;
  overlay.style.display='none';
});

/* ========= SKY (orbit & 15s per fase) ========= */
// Urutan yang kamu minta: Day ‚Üí Sunset ‚Üí Night ‚Üí Dawn
const PHASE_MS = 15000;                    // 15 detik / fase
const DAY_MS   = PHASE_MS * 4;             // total 60 dtk
const BG_FADE_MS = 1200;                   // fade saat ganti fase
const BG_PARALLAX = 0.15;

const phases = [
  { name:'day',    skyTop:'#8fd8ff', skyBot:'#eaf8ff', stars:0,   sunVis:1.0, moonVis:0.0 },
  { name:'sunset', skyTop:'#ffb38a', skyBot:'#ffd9a8', stars:0.2, sunVis:1.0, moonVis:0.3 },
  { name:'night',  skyTop:'#0a0f1e', skyBot:'#121a2c', stars:1.0, sunVis:0.0, moonVis:1.0 },
  { name:'dawn',   skyTop:'#244b9a', skyBot:'#3e74c9', stars:0.3, sunVis:0.8, moonVis:0.6 },
];

let phaseIdx = 0, nextPhaseIdx = 1;
let phaseElapsed = 0;     // ms dalam fase saat ini
let fadeLeft = 0;         // ms sisa transisi
let cloudOffset1=0, cloudOffset2=0;
let lastDt=1/60;

const STARS=Array.from({length:140},()=>({x:Math.random(),y:Math.random()*0.6,tw:0.5+Math.random()*0.6}));

// Orbit elips (selalu kontinu, tidak bergantung fase)
let dayClock = 0; // ms sepanjang "hari"
function sunPos(){
  const frac = (dayClock % DAY_MS) / DAY_MS;                 // 0..1
  const cx=W*0.5, cy=H*0.62, rx=W*0.42, ry=H*0.36;
  const ang = frac*2*Math.PI + Math.PI/2;                    // start = siang (puncak)
  return { x: cx + Math.cos(ang)*rx, y: cy - Math.sin(ang)*ry, elev: Math.sin(ang) };
}
function moonPos(){ const s=sunPos(); const cx=W*0.5, cy=H*0.62, rx=W*0.42, ry=H*0.36; const ang=Math.atan2(cy-s.y, s.x-cx)+Math.PI; return { x: cx + Math.cos(ang)*rx, y: cy - Math.sin(ang)*ry, elev: -s.elev }; }

// util warna
function mixHex(a,b,t){ const p=n=>parseInt(n,16);const A=[p(a.slice(1,3)),p(a.slice(3,5)),p(a.slice(5,7))],B=[p(b.slice(1,3)),p(b.slice(3,5)),p(b.slice(5,7))];const C=A.map((v,i)=>Math.round(v+(B[i]-v)*t));return `#${C.map(v=>v.toString(16).padStart(2,'0')).join('')}`;}
function hexToRgb(h){const p=n=>parseInt(n,16);return[p(h.slice(1,3)),p(h.slice(3,5)),p(h.slice(5,7))];}
const smooth01=t=>t*t*(3-2*t);

// gambar benda langit & langit
function drawGradient(top,bot){ const g=ctx.createLinearGradient(0,0,0,H); g.addColorStop(0,top); g.addColorStop(1,bot); ctx.fillStyle=g; ctx.fillRect(0,0,W,H); }
function drawSunAt(x,y,a){ const R=Math.min(W,H)*0.08; ctx.save(); ctx.globalAlpha=a; ctx.fillStyle='#FFD166'; ctx.beginPath(); ctx.arc(x,y,R,0,Math.PI*2); ctx.fill(); const g=ctx.createRadialGradient(x,y,R*0.25,x,y,R*1.6); g.addColorStop(0,'rgba(255,209,102,0.70)'); g.addColorStop(1,'rgba(255,209,102,0)'); ctx.fillStyle=g; ctx.beginPath(); ctx.arc(x,y,R*1.6,0,Math.PI*2); ctx.fill(); ctx.restore(); }
function drawMoonAt(x,y,a){ const R=Math.min(W,H)*0.06; ctx.save(); ctx.globalAlpha=a; ctx.fillStyle='#E2E8F0'; ctx.beginPath(); ctx.arc(x,y,R,0,Math.PI*2); ctx.fill(); ctx.restore(); }
function drawStars(a){ ctx.save(); ctx.fillStyle='#E5E7EB'; for(const s of STARS){ const tw=0.6+Math.sin(performance.now()/400*s.tw)*0.4; ctx.globalAlpha=a*tw; ctx.fillRect(s.x*W,s.y*H,2,2);} ctx.restore(); }
function drawClouds(phase){ const baseA = (phase.name==='night')? 0.45 : 0.92; ctx.save(); ctx.globalAlpha=baseA; const cloud=(x,y,s)=>{ctx.beginPath();ctx.fillStyle='rgba(255,255,255,0.95)';ctx.arc(x,y,s,0,Math.PI*2);ctx.arc(x+s*0.8,y+s*0.2,s*0.9,0,Math.PI*2);ctx.arc(x-s*0.7,y+s*0.25,s*0.75,0,Math.PI*2);ctx.fill();}; const y1=H*0.18,y2=H*0.28; for(let i=-1;i<=4;i++) cloud((i*0.35*W)+(cloudOffset1%W),y1,Math.min(W,H)*0.07); ctx.globalAlpha=baseA*0.85; for(let i=-1;i<=4;i++) cloud((i*0.50*W)+(cloudOffset2%W),y2,Math.min(W,H)*0.055); ctx.restore(); }

/* ========= Update & Draw ========= */
function needPipe(){ if(!pipes.length) return true; const last=pipes[pipes.length-1]; return (W-last.x) >= rand(PIPE.spawnMin,PIPE.spawnMax); }
function spawnPipe(){ const gap=PIPE.gapBase, top=rand(50, Math.max(50,H-gap-120)); const p={x:W+10,y:top,width:PIPE.width,gap,passed:false}; pipes.push(p); if(Math.random()<BONUS.chance) spawnBonusAtPipe(p); }
function spawnBonusAtPipe(p){ const mid=p.y+p.gap/2; const y=clamp(mid+(Math.random()-0.5)*2*BONUS.yOffset,p.y+20,p.y+p.gap-20); bonuses.push({x:p.x+PIPE.width+120,y,size:BONUS.sizeBase,angle:0}); }

let last=performance.now();
requestAnimationFrame(function loop(now){
  const dt=Math.min(0.033,(now-last)/1000); last=now;
  if(state.running) update(dt);
  draw(dt);
  requestAnimationFrame(loop);
});

function update(dt){
  lastDt=dt;
  // advance "day clock" selalu (agar orbit kontinu meski tidak main)
  dayClock = (dayClock + dt*1000) % DAY_MS;

  // fase & transisi
  phaseElapsed += dt*1000;
  if(phaseElapsed >= PHASE_MS){
    phaseElapsed -= PHASE_MS;
    phaseIdx = (phaseIdx + 1) % phases.length;
    nextPhaseIdx = (phaseIdx + 1) % phases.length;
    fadeLeft = BG_FADE_MS;
  }
  if(fadeLeft > 0){ fadeLeft = Math.max(0, fadeLeft - dt*1000); }

  // gameplay standar
  state.time+=dt;
  state.speed=Math.min(state.speedMax, state.speedBase + state.pipesPassed*state.speedPerPipe);
  if(needPipe()) spawnPipe();

  for(let i=pipes.length-1;i>=0;i--){
    const p=pipes[i]; p.x-=state.speed*dt;
    if(p.x+p.width<-10) pipes.splice(i,1);
    if(!p.passed && p.x+p.width<player.x){ p.passed=true; state.pipesPassed++; state.score+=1; }
  }

  player.vy+=state.gravity*dt; player.y+=player.vy*dt;

  for(const p of pipes){
    if(circleRect(player.x,player.y,player.r,p.x,0,p.width,p.y) ||
       circleRect(player.x,player.y,player.r,p.x,p.y+p.gap,p.width,H-(p.y+p.gap))){ return gameOver(); }
  }
  if(player.y>H-2 || player.y<-20) return gameOver();

  for(let i=bonuses.length-1;i>=0;i--){
    const b=bonuses[i]; b.x-=state.speed*dt; b.angle += BONUS.rotateSpeed*dt;
    if(dist(player.x,player.y,b.x,b.y) < (player.r + b.size*0.5*0.8)){ state.score+=100; bonuses.splice(i,1); continue; }
    if(b.x<-80) bonuses.splice(i,1);
  }

  scoreEl.textContent='Score: '+state.score;

  cloudOffset1 = (cloudOffset1 + state.speed * BG_PARALLAX * 0.50 * dt) % W;
  cloudOffset2 = (cloudOffset2 + state.speed * BG_PARALLAX * 0.25 * dt) % W;
}

function gameOver(){ state.running=false; overlay.style.display='flex'; }

/* ========= DRAW ========= */
function draw(dt){
  // Reset state canvas
  ctx.save(); ctx.setTransform(DPR,0,0,DPR,0,0); ctx.globalAlpha=1; ctx.globalCompositeOperation='source-over';
  ctx.clearRect(0,0,W,H);

  // blending fase
  const tFade = (fadeLeft>0) ? 1 - (fadeLeft/BG_FADE_MS) : 0;
  const cur = phases[phaseIdx], nxt = phases[nextPhaseIdx];

  // langit
  const skyTop = tFade ? mixHex(cur.skyTop, nxt.skyTop, tFade) : cur.skyTop;
  const skyBot = tFade ? mixHex(cur.skyBot, nxt.skyBot, tFade) : cur.skyBot;
  drawGradient(skyTop, skyBot);

  // orbit & alpha
  const s = sunPos(), m = moonPos();
  // base alpha sesuai elevasi terhadap horizon (smooth)
  const aSunElev  = smooth01( clamp((s.elev + 0.05)/0.22, 0, 1) );   // muncul sedikit sebelum melewati horizon
  const aMoonElev = smooth01( clamp((m.elev + 0.02)/0.20, 0, 1) );

  // visibilitas per fase (dibaur saat transisi)
  const visSun  = (cur.sunVis*(1-tFade)) + (nxt.sunVis*tFade);
  const visMoon = (cur.moonVis*(1-tFade)) + (nxt.moonVis*tFade);

  const sunA  = aSunElev  * visSun;
  const moonA = aMoonElev * visMoon;

  // bintang (ikut bobot fase + makin pudar saat ada matahari)
  const starsVis = (cur.stars*(1-tFade) + nxt.stars*tFade) * (1 - sunA*0.85);
  if(starsVis>0.02) drawStars(starsVis);

  // gambar sun & moon
  if(moonA>0.01) drawMoonAt(m.x, m.y, moonA);
  if(sunA >0.01) drawSunAt (s.x, s.y, sunA);

  // awan
  drawClouds(cur);

  // auto kontras skor
  const [r,g,b]=hexToRgb(skyTop);
  const f=x=>{x/=255;return x<=0.03928?x/12.92:Math.pow((x+0.055)/1.055,2.4)};
  const L=0.2126*f(r)+0.7152*f(g)+0.0722*f(b);
  scoreEl.style.color=(L<0.45)?'#fff':'#0b1222';
  scoreEl.style.textShadow=(L<0.45)?'0 1px 2px rgba(0,0,0,.6)':'0 1px 2px rgba(255,255,255,.25)';

  // PIPES
  ctx.fillStyle='#1f4fd1';
  for(const p of pipes){
    ctx.fillRect(p.x,0,p.width,p.y);
    ctx.fillRect(p.x,p.y+p.gap,p.width,H-(p.y+p.gap));
  }

  // PLAYER (bola putih biar simpel)
  if(state.running){
    ctx.fillStyle='#fff'; ctx.beginPath(); ctx.arc(player.x,player.y,player.r,0,Math.PI*2); ctx.fill();
    ctx.strokeStyle='#111'; ctx.lineWidth=2; ctx.stroke();
  }

  ctx.restore();
}

/* ========= DEBUG helper ========= */
window.setPhase = name => {
  const order=['day','sunset','night','dawn'];
  const id = order.indexOf(String(name).toLowerCase());
  if(id>=0){ phaseIdx=id; nextPhaseIdx=(id+1)%4; phaseElapsed=0; fadeLeft=0; }
};
window.clockFreeze = on => { window.__freeze = !!on; }; // tidak dipakai di versi ini, tapi disimpan untuk kelak

})(); // IIFE
</script>
</body>
</html>
